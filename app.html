<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    
    <!-- SEO Meta Tags -->
    <title>截图拼接工具 - 多张截图拼成一张长图 | PictriKit</title>
    <meta name="description" content="在线截图拼接，把多张图拼成一张。聊天记录、微信截图、手机截图都能拼。还能加文字、画箭头、打马赛克。不用下载不用登录，做完一键复制。">
    <meta name="keywords" content="截图拼接, 图片拼接, 长截图, 微信截图拼接, 聊天记录拼接, 手机截图合并, 截图加文字, 截图打码, 在线拼图, screenshot stitch, combine screenshots, image merge, long screenshot, chat screenshot, merge images online">
    <link rel="canonical" href="https://pictrikit.com/app.html">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="截图拼接工具 - 多张图拼成一张">
    <meta property="og:description" content="在线拼接截图，聊天记录、微信截图都能拼。加文字、打马赛克，做完直接复制。">
    <meta property="og:image" content="https://pictrikit.com/assets/images/og-image.png">
    <meta property="og:url" content="https://pictrikit.com/app.html">
    <meta property="og:site_name" content="PictriKit">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:locale:alternate" content="ja_JP">
    <meta property="og:locale:alternate" content="ko_KR">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="截图拼接工具 - 多张图拼成一张">
    <meta name="twitter:description" content="在线拼接截图，聊天记录、微信截图都能拼。加文字、打马赛克，做完直接复制。">
    <meta name="twitter:image" content="https://pictrikit.com/assets/images/og-image.png">
    <meta name="twitter:creator" content="@pictrikit">
    <meta name="twitter:site" content="@pictrikit">
    
    <!-- Multi-language Support -->
    <link rel="alternate" hreflang="en" href="https://pictrikit.com/?lang=en">
    <link rel="alternate" hreflang="zh-CN" href="https://pictrikit.com/?lang=zh-CN">
    <link rel="alternate" hreflang="ja" href="https://pictrikit.com/?lang=ja">
    <link rel="alternate" hreflang="ko" href="https://pictrikit.com/?lang=ko">
    <link rel="alternate" hreflang="x-default" href="https://pictrikit.com/">
    
    <!-- Structured Data - WebApplication Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "PictriKit 截图拼接工具",
      "description": "在线截图拼接工具，把多张截图拼成一张长图。支持聊天记录、微信截图、手机截图的拼接，还能加文字、打马赛克。",
      "url": "https://pictrikit.com/app.html",
      "applicationCategory": "DesignApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "多张截图拼成一张长图",
        "智能对齐，拼接更整齐",
        "裁剪图片，去掉不要的部分",
        "打马赛克，保护隐私信息",
        "加文字、画箭头做标注",
        "加方框、圆圈突出重点",
        "导出PNG、JPG或PDF",
        "一键复制，直接粘贴分享",
        "支持中英日韩四种语言",
        "完全免费，没有水印"
      ],
      "screenshot": "https://pictrikit.com/assets/images/screenshot.png"
    }
    </script>
    
    <!-- Structured Data - Organization Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "PictriKit",
      "url": "https://pictrikit.com",
      "logo": "https://pictrikit.com/assets/images/logo.png",
      "description": "Free online screenshot stitching and combining tool",
      "sameAs": [
        "https://twitter.com/pictrikit",
        "https://facebook.com/pictrikit",
        "https://github.com/pictrikit"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Support",
        "email": "support@pictrikit.com",
        "url": "https://pictrikit.com/contact.html"
      }
    }
    </script>
    
    <!-- Structured Data - HowTo Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Combine Screenshots with PictriKit",
      "description": "Step-by-step guide to combine and edit multiple screenshots into one image",
      "image": "https://pictrikit.com/assets/images/tutorial.png",
      "totalTime": "PT2M",
      "step": [
        {
          "@type": "HowToStep",
          "name": "Upload Screenshots",
          "text": "Click the upload button or drag and drop your screenshots onto the canvas. You can also paste images with Ctrl+V.",
          "image": "https://pictrikit.com/assets/images/step1.png"
        },
        {
          "@type": "HowToStep",
          "name": "Arrange and Align",
          "text": "Drag screenshots to position them. Use smart alignment to snap them together perfectly.",
          "image": "https://pictrikit.com/assets/images/step2.png"
        },
        {
          "@type": "HowToStep",
          "name": "Edit and Annotate",
          "text": "Use crop, blur, shapes, text, and drawing tools to edit and annotate your screenshots.",
          "image": "https://pictrikit.com/assets/images/step3.png"
        },
        {
          "@type": "HowToStep",
          "name": "Export",
          "text": "Click the download button to save as PNG, JPG, or PDF. Or copy to clipboard to paste elsewhere.",
          "image": "https://pictrikit.com/assets/images/step4.png"
        }
      ]
    }
    </script>
    
    <!-- Preconnect to CDNs for faster loading -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    
    <!-- Font Awesome - load synchronously to prevent icon flash -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Pickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css">
    
    <!-- Critical JavaScript - fabric.js must load before app.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
    
    <!-- Defer non-critical JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js" defer></script>
    
    <!-- Main Stylesheet - load synchronously to prevent FOUC -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Favicon and Web App Manifest -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    
    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
</head>
<body data-page="app">
    <div class="app">
        <div class="top-toolbar" role="banner">
            <a href="/index.html" class="logo" title="Return to Home" style="text-decoration: none; color: inherit; cursor: pointer;">
                <i class="fas fa-layer-group" aria-hidden="true"></i>
                <span class="logo-text">PictriKit</span>
            </a>

            <div class="toolbar-right" role="navigation" aria-label="Main navigation"></nav>
                <div class="lang-selector" id="langSelector">
                    <button class="toolbar-btn" onclick="toggleLangDropdown(event)" aria-label="Select language">
                        <i class="fas fa-globe" aria-hidden="true"></i>
                    </button>
                    <div class="lang-dropdown">
                        <div class="lang-option active" data-lang="en" onclick="changeLanguage(event, 'en')">
                            <span>EN</span><span>English</span>
                        </div>
                        <div class="lang-option" data-lang="zh-CN" onclick="changeLanguage(event, 'zh-CN')">
                            <span>CN</span><span>Chinese</span>
                        </div>
                        <div class="lang-option" data-lang="ja" onclick="changeLanguage(event, 'ja')">
                            <span>JP</span><span>Japanese</span>
                        </div>
                        <div class="lang-option" data-lang="ko" onclick="changeLanguage(event, 'ko')">
                            <span>KR</span><span>Korean</span>
                        </div>
                    </div>
                </div>
                
                <button class="toolbar-btn" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>

                <div class="toolbar-divider" aria-hidden="true"></div>

                <button class="toolbar-btn" onclick="shareImage()" aria-label="Share image">
                    <i class="fas fa-share-nodes" aria-hidden="true"></i>
                </button>
                
                <button class="toolbar-btn" onclick="openDownloadModal()" aria-label="Download image">
                    <i class="fas fa-download" aria-hidden="true"></i>
                </button>

                <button class="hamburger-btn" onclick="toggleMobileMenu()" aria-label="Open menu">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
            </div>
        </div>

        <!-- Anime-style Bookmark Bubble -->
        <div id="bookmarkBubble" class="bookmark-bubble" role="dialog" aria-labelledby="bubbleTitle" aria-describedby="bubbleDesc" style="display: none;">
            <button class="bubble-close" onclick="closeBookmarkBubble()" aria-label="Close bookmark tip" tabindex="0">
                <span aria-hidden="true">✕</span>
            </button>
            <div class="bubble-content">
                <div class="bubble-icon">💫</div>
                <p id="bubbleTitle" class="bubble-title">Save for Later!</p>
                <p id="bubbleDesc" class="bubble-text">Bookmark this page to find it easily next time~</p>
            </div>
            <div class="bubble-tail"></div>
        </div>

        <div class="main-content" role="main"></main>
            <div class="sidebar" id="sidebar" role="complementary" aria-label="Tools">
                <div class="sidebar-tools">
                    <!-- 文件操作组 -->
                    <div class="tool-group">
                        <button class="tool-btn" onclick="triggerUpload()" aria-label="Upload images" data-tooltip="Upload">
                            <i class="fas fa-folder-open" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- 对齐工具组 -->
                    <div class="tool-group">
                        <button class="tool-btn active" id="snapToggle" onclick="toggleSnap()" aria-label="Toggle smart align" aria-pressed="true" data-tooltip="Smart Align">
                            <i class="fas fa-magnet" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- 复位操作组 -->
                    <div class="tool-group">
                        <button class="tool-btn" onclick="centerSelected()" aria-label="Center selected" data-tooltip="Center (C)">
                            <i class="fas fa-crosshairs" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- 绘图和标注工具组 -->
                    <div class="tool-group">
                        <button class="tool-btn" id="drawToggle" onclick="toggleDraw()" aria-label="Toggle draw mode" aria-pressed="false" data-tooltip="Draw">
                            <i class="fas fa-paintbrush" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" onclick="addText()" aria-label="Add text" data-tooltip="Text">
                            <i class="fas fa-font" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" onclick="openIconsModal()" aria-label="Design Icons" data-tooltip="Icons">
                            <i class="fas fa-icons" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" id="shapeToggle" onclick="toggleShapePanel()" aria-label="Add shape" data-tooltip="Shapes">
                            <i class="fas fa-shapes" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- 图片编辑工具组 -->
                    <div class="tool-group">
                        <button class="tool-btn" id="cropToggle" onclick="toggleCrop()" aria-label="Crop image" disabled data-tooltip="Crop">
                            <i class="fas fa-crop-simple" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" id="blurToggle" onclick="toggleBlur()" aria-label="Blur image" disabled data-tooltip="Blur">
                            <i class="fas fa-droplet" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" id="pixelateToggle" onclick="togglePixelate()" aria-label="Pixelate image" disabled data-tooltip="Pixelate">
                            <i class="fas fa-th" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" onclick="flipHorizontal()" aria-label="Flip horizontal" data-tooltip="Flip H">
                            <i class="fas fa-arrows-left-right" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" onclick="flipVertical()" aria-label="Flip vertical" data-tooltip="Flip V">
                            <i class="fas fa-arrows-up-down" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- 历史操作组 -->
                    <div class="tool-group">
                        <button class="tool-btn" onclick="undo()" aria-label="Undo" data-tooltip="Undo">
                            <i class="fas fa-rotate-left" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" onclick="redo()" aria-label="Redo" data-tooltip="Redo">
                            <i class="fas fa-rotate-right" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- 删除操作组 -->
                    <div class="tool-group">
                        <button class="tool-btn" onclick="deleteSelected()" aria-label="Delete selected" data-tooltip="Delete">
                            <i class="fas fa-trash-alt" aria-hidden="true"></i>
                        </button>
                        <button class="tool-btn" onclick="clearAll()" aria-label="Clear all" data-tooltip="Clear">
                            <i class="fas fa-broom" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 移动端悬浮工具按钮 -->
            <button class="sidebar-fab" onclick="toggleMobileToolbar()">
                <i class="fas fa-magic"></i>
            </button>

            <div class="mobile-toolbar-popup" id="mobileToolbarPopup">
                <button class="mobile-tool-btn" onclick="triggerUpload(); toggleMobileToolbar();">
                    <i class="fas fa-folder-open"></i>
                </button>
                <div class="mobile-tool-divider"></div>
                <button class="mobile-tool-btn active" id="snapToggleMobile" onclick="toggleSnapMobile()">
                    <i class="fas fa-magnet"></i>
                </button>
                <button class="mobile-tool-btn" id="drawToggleMobile" onclick="toggleDrawMobile()">
                    <i class="fas fa-paintbrush"></i>
                </button>
                <button class="mobile-tool-btn" onclick="addText(); toggleMobileToolbar();">
                    <i class="fas fa-font"></i>
                </button>
                <button class="mobile-tool-btn" onclick="openIconsModal(); toggleMobileToolbar();">
                    <i class="fas fa-icons"></i>
                </button>
                <button class="mobile-tool-btn" onclick="openSettingsModal('shape'); toggleMobileToolbar();">
                    <i class="fas fa-shapes"></i>
                </button>
                <div class="mobile-tool-divider"></div>
                <button class="mobile-tool-btn" id="cropToggleMobile" onclick="toggleCropMobile()" disabled>
                    <i class="fas fa-crop-simple"></i>
                </button>
                <button class="mobile-tool-btn" id="blurToggleMobile" onclick="toggleBlur(); toggleMobileToolbar();" disabled>
                    <i class="fas fa-droplet"></i>
                </button>
                <button class="mobile-tool-btn" id="pixelateToggleMobile" onclick="togglePixelate(); toggleMobileToolbar();" disabled>
                    <i class="fas fa-th"></i>
                </button>
                <div class="mobile-tool-divider"></div>
                <button class="mobile-tool-btn" onclick="undo(); toggleMobileToolbar();">
                    <i class="fas fa-rotate-left"></i>
                </button>
                <button class="mobile-tool-btn" onclick="redo(); toggleMobileToolbar();">
                    <i class="fas fa-rotate-right"></i>
                </button>
                <div class="mobile-tool-divider"></div>
                <button class="mobile-tool-btn" onclick="deleteSelected(); toggleMobileToolbar();">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button class="mobile-tool-btn" onclick="clearAll(); toggleMobileToolbar();">
                    <i class="fas fa-broom"></i>
                </button>
            </div>

            <div class="canvas-wrapper">
                <div class="canvas-container" id="canvasContainer" aria-label="Canvas workspace">
                    <canvas id="canvas" role="img" aria-label="Screenshot editing canvas"></canvas>
                    
                    <div class="zoom-floating">
                        <button class="toolbar-btn" onclick="zoomIn()">
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="zoom-text" id="zoomLevel">100%</div>
                        <button class="toolbar-btn" onclick="zoomOut()">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="toolbar-btn" onclick="resetZoom()">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                    
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <h3 data-i18n="emptyTitle">Start Combining Screenshots</h3>
                        <p data-i18n="emptyDesc">Upload • Drag & Drop • Ctrl+V Paste</p>
                    </div>
                </div>
            </div>

            <div class="right-panel" id="rightPanel">
                <div class="panel-section">
                    <button class="drawer-trigger" onclick="openSettingsModal('background')">
                        <span><i class="fas fa-palette"></i> <span data-i18n="bgSettings">Background Settings</span></span>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <div class="drawer-content" id="bgDrawer">
                        <div class="drawer-inner">
                            <div class="settings-group">
                                <label class="settings-label">Background Type</label>
                                <div class="icon-btn-group">
                                    <button class="icon-btn" onclick="setBgTransparent()" title="Transparent">
                                        <i class="fas fa-border-none"></i>
                                    </button>
                                    <button class="icon-btn bg-color-btn" id="bgColorBtn" onclick="openBgColorPicker()" title="Color">
                                        <div class="pickr" id="bgColorPicker"></div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <button class="drawer-trigger" onclick="openSettingsModal('shape')">
                        <span><i class="fas fa-shapes"></i> <span data-i18n="shapeSettings">Shape Settings</span></span>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <div class="drawer-content" id="shapeDrawer">
                        <div class="drawer-inner">
                            <div class="settings-group">
                                <label class="settings-label">Add Shape</label>
                                <div class="icon-btn-group">
                                    <button class="icon-btn" onclick="addRectangle()" title="Rectangle">
                                        <i class="fas fa-square"></i>
                                    </button>
                                    <button class="icon-btn" onclick="addCircle()" title="Circle">
                                        <i class="fas fa-circle"></i>
                                    </button>
                                    <button class="icon-btn" onclick="addLine()" title="Line">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button class="icon-btn" onclick="addArrow()" title="Arrow">
                                        <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <label class="settings-label">Color</label>
                                <div id="shapeColorPicker"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <button class="drawer-trigger" onclick="openSettingsModal('draw')">
                        <span><i class="fas fa-paintbrush"></i> <span data-i18n="drawSettings">Draw Settings</span></span>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <div class="drawer-content" id="drawDrawer">
                        <div class="drawer-inner">
                            <div class="settings-group">
                                <label class="settings-label">Brush Color</label>
                                <div id="drawColorPicker"></div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="slider-control">
                                    <div class="slider-header">
                                        <span class="slider-icon"><i class="fas fa-paintbrush"></i> Brush Size</span>
                                        <span class="slider-value" id="brushSizeValue">5px</span>
                                    </div>
                                    <input type="range" id="brushSize" min="1" max="50" value="5" onchange="updateBrushSize(this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <button class="drawer-trigger" id="textDrawerTrigger" onclick="openSettingsModal('text')">
                        <span><i class="fas fa-font"></i> <span data-i18n="textSettings">Text Settings</span></span>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <div class="drawer-content" id="textDrawer">
                        <div class="drawer-inner">
                            <div class="settings-group">
                                <label class="settings-label">Font</label>
                                <div class="control-row">
                                    <select id="fontFamily" class="control-select" onchange="updateTextFont(this.value)">
                                        <option value="Arial">Arial</option>
                                        <option value="Helvetica">Helvetica</option>
                                        <option value="Times New Roman">Times New Roman</option>
                                        <option value="Georgia">Georgia</option>
                                        <option value="Verdana">Verdana</option>
                                        <option value="Courier New">Courier New</option>
                                        <option value="Comic Sans MS">Comic Sans</option>
                                        <option value="Impact">Impact</option>
                                        <option value="Trebuchet MS">Trebuchet</option>
                                        <option value="Microsoft YaHei">微软雅黑</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <label class="settings-label">Size & Weight</label>
                                <div class="control-row">
                                    <input type="number" id="fontSize" min="8" max="200" value="32" class="control-input" onchange="updateTextSize(this.value)">
                                    <select id="fontWeight" class="control-select" onchange="updateTextWeight(this.value)">
                                        <option value="normal">Normal</option>
                                        <option value="bold">Bold</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <label class="settings-label">Alignment</label>
                                <div class="icon-btn-group">
                                    <button class="icon-btn" onclick="updateTextAlign('left')" title="Left">
                                        <i class="fas fa-align-left"></i>
                                    </button>
                                    <button class="icon-btn" onclick="updateTextAlign('center')" title="Center">
                                        <i class="fas fa-align-center"></i>
                                    </button>
                                    <button class="icon-btn" onclick="updateTextAlign('right')" title="Right">
                                        <i class="fas fa-align-right"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <div class="slider-control">
                                    <div class="slider-header">
                                        <span class="slider-icon"><i class="fas fa-text-height"></i> Line Height</span>
                                        <span class="slider-value" id="lineHeightValue">1.16</span>
                                    </div>
                                    <input type="range" id="lineHeight" min="0.8" max="2.5" step="0.1" value="1.16" onchange="updateLineHeight(this.value)">
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <label class="settings-label">Color</label>
                                <div id="textColorPicker"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <button class="drawer-trigger" id="layerDrawerTrigger" onclick="openSettingsModal('layer')">
                        <span><i class="fas fa-layer-group"></i> <span data-i18n="layerSettings">Layer Order</span></span>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <div class="drawer-content" id="layerDrawer">
                        <div class="drawer-inner">
                            <div class="settings-group">
                                <label class="settings-label">Layer Control</label>
                                <div class="icon-btn-group">
                                    <button class="icon-btn" onclick="bringToFront()" title="Bring to Front">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                    <button class="icon-btn" onclick="bringForward()" title="Bring Forward">
                                        <i class="fas fa-chevron-up"></i>
                                    </button>
                                    <button class="icon-btn" onclick="sendBackward()" title="Send Backward">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <button class="icon-btn" onclick="sendToBack()" title="Send to Back">
                                        <i class="fas fa-arrow-down"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="settings-group">
                                <label class="settings-label">Lock Layer</label>
                                <div class="icon-btn-group">
                                    <button class="icon-btn" onclick="toggleLock()" title="Lock/Unlock" id="lockBtn">
                                        <i class="fas fa-lock-open"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer" role="contentinfo">
            <span>© 2025 PictriKit. All rights reserved.</span>
        </div>
    </div>

    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <h3 data-i18n="menu">Menu</h3>
            <button class="mobile-menu-close" onclick="closeMobileMenu()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="mobile-menu-section">
            <div class="mobile-menu-title" data-i18n="background">BACKGROUND</div>
            <div class="bg-options-row">
                <div class="bg-option-card bg-transparent" onclick="setBgTransparent(); closeAllDrawers();">
                    <i class="fas fa-border-none"></i>
                    <span data-i18n="transparent">Transparent</span>
                </div>
                <div class="bg-option-card bg-color-card" id="bgColorCardMobile" onclick="openBgColorPickerMobile()">
                    <i class="fas fa-palette" style="color: white; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));"></i>
                    <span style="color: white; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));" data-i18n="color">Color</span>
                    <div class="pickr" id="bgColorPickerMobile"></div>
                </div>
            </div>
        </div>

        <div class="mobile-menu-section">
            <div class="mobile-menu-title" data-i18n="shapeEdit">SHAPES</div>
            <div class="shape-options-row">
                <div class="shape-option-card" onclick="addRectangle(); closeMobileMenu();">
                    <i class="fas fa-square"></i>
                    <span data-i18n="rectangle">Rectangle</span>
                </div>
                <div class="shape-option-card" onclick="addCircle(); closeMobileMenu();">
                    <i class="fas fa-circle"></i>
                    <span data-i18n="circle">Circle</span>
                </div>
                <div class="shape-option-card" onclick="addLine(); closeMobileMenu();">
                    <i class="fas fa-minus"></i>
                    <span data-i18n="line">Line</span>
                </div>
                <div class="shape-option-card" onclick="addArrow(); closeMobileMenu();">
                    <i class="fas fa-arrow-right"></i>
                    <span data-i18n="arrow">Arrow</span>
                </div>
            </div>
        </div>

        <div class="mobile-menu-section">
            <div class="mobile-menu-title" data-i18n="drawEdit">DRAW</div>
            <div class="property-row">
                <label class="property-label" data-i18n="drawColor">Color</label>
                <div id="drawColorPickerMobile"></div>
            </div>
            <div class="property-row">
                <label class="property-label" data-i18n="brushSize">Brush Size</label>
                <input type="range" id="brushSizeMobile" min="1" max="50" value="5" class="property-select" onchange="updateBrushSize(this.value)" style="width: 100%;">
                <div style="text-align: center; font-size: 12px; color: var(--text-secondary); margin-top: 4px;" id="brushSizeValueMobile">5px</div>
            </div>
        </div>

        <div class="mobile-menu-section">
            <div class="mobile-menu-title" data-i18n="textEdit">TEXT</div>
            <div class="property-row-double">
                <div>
                    <label class="property-label" data-i18n="font">Font</label>
                    <select id="fontFamilyMobile" class="property-select" onchange="updateTextFont(this.value); closeAllDrawers();">
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Impact">Impact</option>
                        <option value="Microsoft YaHei">微软雅黑</option>
                    </select>
                </div>
                <div>
                    <label class="property-label" data-i18n="weight">Weight</label>
                    <select id="fontWeightMobile" class="property-select" onchange="updateTextWeight(this.value); closeAllDrawers();">
                        <option value="normal">Normal</option>
                        <option value="bold">Bold</option>
                    </select>
                </div>
            </div>
            <div class="property-row">
                <label class="property-label" data-i18n="textColor">Color</label>
                <div id="textColorPickerMobile"></div>
            </div>
        </div>

    </div>

    <input type="file" id="fileInput" accept="image/*" multiple>
    <input type="file" id="bgInput" accept="image/*">

    <div class="toast" id="toast"></div>
    <div class="zoom-toast" id="zoomToast"></div>

    <div class="share-modal" id="shareModal" onclick="closeShareModal()">
        <div class="share-content" onclick="event.stopPropagation()">
            <h3 data-i18n="shareTitle">Share</h3>
            <div class="share-option-group">
                <div class="share-option-label" data-i18n="exportMode">Export Mode</div>
                <div class="share-option-buttons">
                    <button class="share-mode-btn active" id="shareModeFull" onclick="setShareMode('full')">
                        <i class="fas fa-expand"></i>
                        <span data-i18n="fullCanvas">Full Canvas</span>
                    </button>
                    <button class="share-mode-btn" id="shareModeSmart" onclick="setShareMode('smart')">
                        <i class="fas fa-crop-simple"></i>
                        <span data-i18n="smartCrop">Smart Crop</span>
                    </button>
                </div>
            </div>
            <button onclick="copyToClipboard()">
                <i class="fas fa-clipboard"></i>
                <span data-i18n="copyClipboard">Copy to Clipboard</span>
            </button>
            <button onclick="closeShareModal()">
                <span data-i18n="cancel">Cancel</span>
            </button>
        </div>
    </div>

    <div class="share-modal" id="downloadModal" onclick="closeDownloadModal()">
        <div class="share-content" onclick="event.stopPropagation()">
            <h3 data-i18n="downloadTitle">Download</h3>
            <div class="share-option-group">
                <div class="share-option-label" data-i18n="exportMode">Export Mode</div>
                <div class="share-option-buttons">
                    <button class="share-mode-btn active" id="downloadModeFull" onclick="setDownloadMode('full')">
                        <i class="fas fa-expand"></i>
                        <span data-i18n="fullCanvas">Full Canvas</span>
                    </button>
                    <button class="share-mode-btn" id="downloadModeSmart" onclick="setDownloadMode('smart')">
                        <i class="fas fa-crop-simple"></i>
                        <span data-i18n="smartCrop">Smart Crop</span>
                    </button>
                </div>
            </div>
            <button onclick="downloadImage('png')">
                <i class="fas fa-file-image"></i>
                <span data-i18n="downloadPNG">Download PNG</span>
            </button>
            <button onclick="downloadImage('jpg')">
                <i class="fas fa-file-image"></i>
                <span data-i18n="downloadJPG">Download JPG</span>
            </button>
            <button onclick="downloadPDF()">
                <i class="fas fa-file-pdf"></i>
                <span data-i18n="downloadPDF">Download PDF</span>
            </button>
            <button onclick="closeDownloadModal()">
                <span data-i18n="cancel">Cancel</span>
            </button>
        </div>
    </div>

    <div class="share-modal" id="iconsModal" onclick="closeIconsModal()">
        <div class="share-content" onclick="event.stopPropagation()" style="max-width: 700px; max-height: 85vh;">
            <h3 style="margin-bottom: 16px;">
                <i class="fas fa-icons"></i> 
                <span data-i18n="icons">Design Icons</span>
            </h3>
            <!-- 颜色和大小选择 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                <div>
                    <label style="font-size: 13px; font-weight: 600; color: var(--text-secondary); display: block; margin-bottom: 8px;">Color:</label>
                    <div id="iconColorPicker" style="width: 100%;"></div>
                </div>
                <div>
                    <label style="font-size: 13px; font-weight: 600; color: var(--text-secondary); display: block; margin-bottom: 8px;">Size:</label>
                    <input type="range" id="iconSizeSlider" min="20" max="200" value="60" 
                        style="width: 100%; margin-top: 8px;"
                        oninput="document.getElementById('iconSizeValue').textContent = this.value + 'px'">
                    <div id="iconSizeValue" style="text-align: center; font-size: 12px; color: var(--text-secondary); margin-top: 4px;">60px</div>
                </div>
            </div>
            <div style="margin-bottom: 16px;">
                <input type="text" id="iconSearch" placeholder="Search icons (e.g., heart, star, arrow)..." 
                    style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 14px; background: var(--bg-secondary); color: var(--text-primary);"
                    onkeyup="searchIcons(this.value)">
            </div>
            <div style="margin-bottom: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="icon-category-btn active" onclick="loadIconCategory('popular', this)">Popular</button>
                <button class="icon-category-btn" onclick="loadIconCategory('business', this)">Business</button>
                <button class="icon-category-btn" onclick="loadIconCategory('social', this)">Social</button>
                <button class="icon-category-btn" onclick="loadIconCategory('arrows', this)">Arrows</button>
                <button class="icon-category-btn" onclick="loadIconCategory('shapes', this)">Shapes</button>
            </div>
            <div id="iconsGrid" style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 8px; max-height: 450px; overflow-y: auto; padding: 8px; background: var(--bg-secondary); border-radius: 8px;">
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i class="fas fa-search" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                    <p>Search for icons or select a category</p>
                </div>
            </div>
            <button onclick="closeIconsModal()" style="margin-top: 16px; width: 100%; padding: 12px; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-primary);">
                <i class="fas fa-times"></i> <span data-i18n="cancel">Cancel</span>
            </button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal" onclick="closeSettingsModal()">
        <div class="settings-modal-content" onclick="event.stopPropagation()">
            <button class="settings-modal-close" onclick="closeSettingsModal()">
                <i class="fas fa-times"></i>
            </button>
            <div class="settings-modal-body" id="settingsModalBody">
                <!-- 设置内容将动态加载到这里 -->
            </div>
        </div>
    </div>

    <!-- Load i18n first, then main app -->
    <script src="/assets/js/i18n.js"></script>
    <script src="/assets/js/app.js"></script>
    
    <!-- Language switching functions -->
    <script>
        function changeLanguage(event, lang) {
            event.stopPropagation();
            
            if (typeof I18n !== 'undefined' && typeof I18n.changeLanguage === 'function') {
                I18n.changeLanguage(lang);
            }
            
            // Update active state
            document.querySelectorAll('.lang-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-lang') === lang) {
                    option.classList.add('active');
                }
            });
            
            // Close dropdown
            const selector = document.getElementById('langSelector');
            if (selector) {
                selector.classList.remove('active');
            }
        }
        
        function toggleLangDropdown(event) {
            event.stopPropagation();
            const selector = document.getElementById('langSelector');
            if (selector) {
                selector.classList.toggle('active');
            }
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                const iconEl = themeToggle.querySelector('i');
                if (iconEl) {
                    iconEl.className = icon;
                }
            }
            
            // Update canvas background color
            if (typeof canvas !== 'undefined' && canvas) {
                canvas.backgroundColor = newTheme === 'light' ? '#ffffff' : '#1f1f1f';
                canvas.renderAll();
            }
        }
        
        // Settings drawer toggle function
        function openSettingsModal(type) {
            const drawers = {
                'background': 'bgDrawer',
                'shape': 'shapeDrawer',
                'draw': 'drawDrawer',
                'text': 'textDrawer',
                'layer': 'layerDrawer'
            };
            
            const drawerId = drawers[type];
            if (!drawerId) return;
            
            const drawer = document.getElementById(drawerId);
            if (!drawer) return;
            
            // Toggle the drawer
            const isOpen = drawer.classList.contains('show');
            
            // Close all drawers first
            Object.values(drawers).forEach(id => {
                const d = document.getElementById(id);
                if (d) d.classList.remove('show');
            });
            
            // Open the clicked drawer if it was closed
            if (!isOpen) {
                drawer.classList.add('show');
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const langSelector = document.getElementById('langSelector');
            if (langSelector && !langSelector.contains(e.target)) {
                langSelector.classList.remove('active');
            }
        });
        
        // Initialize theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const icon = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                const iconEl = themeToggle.querySelector('i');
                if (iconEl) {
                    iconEl.className = icon;
                }
            }
            
            // Set active language option
            const savedLang = localStorage.getItem('language') || localStorage.getItem('preferredLanguage') || 'en';
            document.querySelectorAll('.lang-option').forEach(option => {
                if (option.getAttribute('data-lang') === savedLang) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        });
    </script>
    
    <!-- AdBlock Detection -->
    <script src="/assets/js/adblock-detect.js"></script>
</body>
</html>
